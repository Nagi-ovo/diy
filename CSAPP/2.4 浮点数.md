## 4. 浮点数

## IEEE Floating-Point Representation

### 单精度和64位双精度
![[storage bag/Screenshot 2023-11-08 at 16.28.14.png]]
> sign bit：符号位
> exponent field：指数位，阶码
> fraction：*Mantissa*，尾数，小数部分的有效数字(*Significand*)
## 浮点数种类

### *Normalized Values*（规格化的值）

![[storage bag/Screenshot 2023-11-08 at 16.49.42.png]]
$$V=(-1)^S\times M \times 2^E$$
$e_{min}=1, e_{max}=254$
$$E=e-bias$$
$$bias(float)=2^{8-1}-1=127 \therefore E_{min}=-126,E_{max}=127$$
$$bias(double)=2^{11-1}-1=1023$$

尾数$M$被定义为$1+f$，尾数$M$的二进制表示为：

![[storage bag/Screenshot 2023-11-08 at 17.37.30.png]]
> 因为可以通过调整$E$的取值，使尾数$M\in[1,2)$，所以第一位不需要显示的表示出来，这也是为什么尾数$M$要`+1`。

### *Denormalized Values*（非规格化的值）

![[storage bag/Screenshot 2023-11-08 at 16.49.56.png]]
$$V=(-1)^S\times M \times 2^E$$
##### 非规格数的用途：
1. 提供了表示数值0的方法。
```markdown
Case 0: s = 0, M = f = 0, V = +0.0;
Case 1: s = 1, M = f = 0, V = -0.0;
```

$$E=1-bias$$
$$M = f$$
> 这里与规格化的值解释方法不同，需要注意。
 
### *Special Values*（特殊值）

$$V=(-1)^S\times M \times 2^E$$
![[storage bag/Screenshot 2023-11-08 at 16.50.15.png]]

```markdown
Case 0: s = 0, f = 0, V = +∞
Case 1: s = 1, f = 0, V = -∞
```
### Not a Number(*NaN*)
![[storage bag/Screenshot 2023-11-08 at 16.50.27.png]]

$$\sqrt{-1}, \infty-\infty$$
8位浮点数举例：
#### 非规格化：
![[storage bag/Screenshot 2023-11-10 at 14.00.10.png]]

#### 规格化：
![[storage bag/Screenshot 2023-11-10 at 14.04.58.png]]

![[storage bag/Screenshot 2023-11-10 at 14.05.53.png]]

## 整型数转换为浮点数

![[storage bag/Screenshot 2023-11-10 at 14.11.03.png]]

### Rounding 

由于表示方法的原因，限制了浮点数的范围和精度，所以浮点运算只能近似的表示实数运算。所以我们希望找到最接近的值来代替原来的值。

$$x\to x', x = 1.5, x'=1\ or \ 2\ ?$$
#### 1. Round-down(向下舍入)
#### 2. Round-up(向上舍入)
#### 3. Round-toward-zero(向零舍入)
![[storage bag/Screenshot 2023-11-10 at 14.18.31.png]]
#### 4. Round-to-even(向偶数舍入)
![[storage bag/Screenshot 2023-11-10 at 14.23.07.png]]
> 避免了向下、向上舍入的统计偏差。

对于不想舍入到整数的情况，我们只需要考虑最低有效位是偶数还是奇数即可：
![[storage bag/Screenshot 2023-11-10 at 14.25.11.png]]

## 浮点数加法

舍入会失去精度，所以浮点数的**加法不具有结合性**
![[storage bag/Screenshot 2023-11-10 at 14.36.04.png]]

同时，由于计算结果可能发生溢出，或者由于舍入而失去精度。所以浮点数的**乘法不具有结合性**
![[storage bag/Screenshot 2023-11-10 at 14.36.22.png]]

此外，浮点**乘法在加法上不具备分配性**
![[storage bag/Screenshot 2023-11-10 at 14.36.32.png]]
